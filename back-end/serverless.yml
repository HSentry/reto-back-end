# "service" is the name of this project. This will also be added to your AWS resource names.
service: reto-back

frameworkVersion: "4"

stages:
  default:
    params:
      tableName: "users-table-${sls:stage}"

provider:
  name: aws
  runtime: nodejs20.x
  iam:
    role:
      statements:
        - Effect: Allow
          Action:
            - dynamodb:Query
            - dynamodb:Scan
            - dynamodb:GetItem
            - dynamodb:PutItem
            - dynamodb:UpdateItem
            - dynamodb:DeleteItem
          Resource:
            - Fn::GetAtt: [UsersTable, Arn]
  environment:
    USERS_TABLE: ${param:tableName}

functions:
functions:
  - ${file(cloudformation/functions.yml)}


  # api:
  #   handler: handler.handler
  #   events:
  #     - httpApi: "*"

resources:
  - ${file(cloudformation/dynamodb.yml)}
  - ${file(cloudformation/cloudfront.yml)}
  - ${file(cloudformation/resources.yml)}
  - ${file(cloudformation/opensearch.yml)}



  # Resources:
  #   UsersTable:
  #     Type: AWS::DynamoDB::Table
  #     Properties:
  #       AttributeDefinitions:
  #         - AttributeName: userId
  #           AttributeType: S
  #       KeySchema:
  #         - AttributeName: userId
  #           KeyType: HASH
  #       BillingMode: PAY_PER_REQUEST
  #       TableName: ${param:tableName}
